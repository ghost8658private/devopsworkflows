name: Copy Branch to Another Repo

on:
  push:
    branches:
      - main 

env:
    GIT_USERNAME: ${{ secrets.GIT_USERNAME }}
    GIT_PASSWORD: ${{ secrets.GIT_PASSWORD }}

jobs:
  copy_branch:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout Source Repo
        uses: actions/checkout@v2
        with:
          ref: ${{ github.event.before }}
          token: ${{ secrets.SOURCE_REPO_ACCESS_TOKEN }}
      
      - name: Create New Branch in Target Repo
        run: |
          git config user.name "ghost8658private"
          git config user.email "bbbeeeaaabbb9@gmail.com"
          git checkout -b mainn  # Replace with the name of the branch you want to create in the target repo
          git pull
          git push origin mainn
      
      - name: Checkout Target Repo
        uses: actions/checkout@v2
        with:
          repository: ghost8658private/trtos.git  # Replace with the target repository's owner and name
          ref: mainn
      
      - name: Commit and Push Changes
        run: |
          # Copy the files from the source branch to the target branch
          cp -r ghost8658private/ttesting* ghost8658private/trtos
          
          # Commit and push the changes to the target repo
          git add .
          git commit -m "Copy changes from source branch"
          git push origin mainn
      
